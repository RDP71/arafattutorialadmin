<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Learning App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --primary: #6C63FF; 
            --primary-grad: linear-gradient(135deg, #8A2BE2 0%, #6C63FF 100%);
            --bg: #F4F6F9;
            --text-dark: #2D3436;
            --text-light: #B2BEC3;
            --white: #FFFFFF;
            --card-shadow: 0 10px 40px -10px rgba(0,0,0,0.05);
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; -webkit-tap-highlight-color:transparent; }
        body { background: var(--bg); color: var(--text-dark); padding-bottom: 90px; }

        /* BUTTONS */
        .btn { padding: 14px; border-radius: 16px; font-weight: 600; cursor: pointer; border: none; width: 100%; transition: 0.2s; background: var(--primary-grad); color: white; display:block; text-align:center; box-shadow: 0 5px 15px rgba(108, 99, 255, 0.3); }
        .btn:active { transform: scale(0.97); }
        .btn-outline { background: transparent; border: 2px solid #E0E0E0; color: #636E72; box-shadow: none; }

        /* AUTH SCREEN */
        #auth-screen { position: fixed; inset: 0; background: var(--white); z-index: 5000; padding: 40px 30px; display: flex; flex-direction: column; justify-content: center; text-align: center; }
        .input-box { width: 100%; background: #F8F9FE; border: 2px solid transparent; color: #2D3436; padding: 16px; border-radius: 14px; margin-bottom: 15px; outline: none; font-size: 1rem; transition: 0.3s; font-weight: 500; }
        .input-box:focus { background: #fff; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.1); }
        
        /* APP HEADER */
        header { position: sticky; top: 0; background: rgba(244, 246, 249, 0.85); backdrop-filter: blur(15px); z-index: 900; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); }
        #app-logo-header { width:40px; height:40px; border-radius:12px; margin-right:12px; object-fit: cover; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: none; }
        
        /* CHIPS */
        .promo-scroll { display: flex; gap: 15px; overflow-x: auto; padding: 15px 20px; scrollbar-width: none; }
        .promo-card { min-width: 85vw; height: 180px; border-radius: 20px; background-size: cover; background-position: center; border: 1px solid white; box-shadow: var(--card-shadow); }
        .chip { background: white; padding: 10px 20px; border-radius: 25px; margin-right: 10px; display: inline-block; cursor:pointer; font-size: 0.9rem; font-weight: 600; color: #636E72; border: 1px solid #EFEFEF; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .chip.active { background: var(--primary-grad); color: white; border-color: transparent; box-shadow: 0 5px 15px rgba(108, 99, 255, 0.3); }
        .chip-con { overflow-x: auto; white-space: nowrap; padding: 5px 20px 20px; }

        /* CARDS */
        .card { background: white; border-radius: 24px; padding: 0; margin-bottom: 20px; border: 1px solid #fff; box-shadow: var(--card-shadow); overflow: hidden; transition: transform 0.2s; }
        .card:active { transform: scale(0.98); }
        .card-body { padding: 15px 20px; }
        .course-img { width: 100%; height: 180px; object-fit: cover; background: #EEE; }
        
        /* NAV BAR */
        .nav-bar { position: fixed; bottom: 20px; left: 20px; right: 20px; height: 65px; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); display: none; justify-content: space-around; align-items: center; border-radius: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); z-index: 1000; padding-bottom: 0; }
        .nav-icon { color: #B2BEC3; font-size: 1.2rem; display: flex; flex-direction: column; align-items: center; gap: 0px; cursor:pointer; }
        .nav-icon.active { color: var(--primary); }
        .nav-icon i { font-size: 1.4rem; margin-bottom: 4px; }
        .nav-text { font-size: 0.7rem; font-weight: 600; }

        /* SCREENS & MODALS */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.3); backdrop-filter: blur(5px); z-index: 2000; display: none; align-items: flex-end; justify-content: center; }
        .modal-sheet { background: white; width: 100%; border-radius: 30px 30px 0 0; padding: 30px; max-height: 90vh; overflow-y: auto; box-shadow: 0 -10px 40px rgba(0,0,0,0.1); animation: slideUp 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .screen { display: none; padding-bottom: 20px; animation: fade 0.3s; }
        @keyframes fade { from{opacity:0}to{opacity:1} }

        #toast-box { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #2D3436; color: white; padding: 12px 24px; border-radius: 50px; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 5000; box-shadow: 0 10px 20px rgba(0,0,0,0.2); font-weight: 600; }
        
        .notif-item { padding: 15px; border-bottom: 1px solid #f0f0f0; display: flex; gap: 15px; align-items: flex-start; }
        .notif-icon { width: 40px; height: 40px; border-radius: 12px; background: rgba(108, 99, 255, 0.1); color: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <img id="auth-logo" style="width:80px; border-radius:20px; margin: 0 auto 25px; display:none; box-shadow: 0 10px 30px rgba(108, 99, 255, 0.2);">
        <h1 id="auth-title" style="font-size: 2rem; color: #2D3436; margin-bottom: 5px;">Learning App</h1>
        <p style="color: #888; margin-bottom: 30px; font-weight: 500;">Login to continue your journey</p>
        
        <input class="input-box" type="text" id="a-name" placeholder="Full Name" style="display: none;">
        <input class="input-box" type="email" id="a-email" placeholder="Email Address">
        <input class="input-box" type="password" id="a-pass" placeholder="Password">
        
        <button class="btn" onclick="submitAuth()" id="btn-auth">Sign In</button>
        <div class="toggle-txt" onclick="toggleMode()" style="margin-top: 20px; font-size: 0.9rem; color: #888;">
            <span id="txt-mode" style="color:var(--primary); font-weight:700;">Create new account</span>
        </div>
    </div>

    <div id="main-app" style="display:none;">
        <header>
            <div style="display:flex; align-items:center;">
                <img id="header-logo" src="" style="display:none;">
                <div>
                    <h3 id="app-title-head" style="font-size:1.1rem; line-height:1.2;">MyApp</h3>
                    <small id="u-name" style="color:#aaa; font-weight:500;">Student</small>
                </div>
            </div>
            <div style="position:relative; width: 40px; height: 40px; background: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05);" onclick="openNotif()">
                <i class="fas fa-bell" style="font-size:1.2rem; color: #2D3436;"></i>
                <div id="n-badge" style="width:10px;height:10px;background:#FF6B6B;border:2px solid white;border-radius:50%;position:absolute;top:8px;right:8px;display:none"></div>
            </div>
        </header>

        <div id="tab-home" class="screen" style="display:block;">
            <div class="promo-scroll" id="home-promo"></div>
            <h3 style="margin:20px 20px 15px; color:#2D3436;">Topics</h3>
            <div class="chip-con" id="cat-chips"></div>
            <h3 style="margin:5px 20px 15px; color:#2D3436;">Popular Courses</h3>
            <div id="home-courses" style="padding: 0 20px;"></div>
        </div>

        <div id="tab-courses" class="screen">
            <div style="padding: 20px;">
                <input class="input-box" id="search" placeholder="Search for courses..." onkeyup="renderC()" style="background:white; border:none; box-shadow: var(--card-shadow);">
            </div>
            <div id="all-courses" style="padding: 0 20px;"></div>
        </div>

        <div id="tab-live" class="screen" style="padding: 20px;">
            <div id="live-con"></div>
        </div>

        <div id="tab-notif" class="screen">
            <h2 style="padding: 20px 20px 0;">Notifications</h2>
            <div id="list-notif" style="margin-top: 10px;"></div>
        </div>

        <div id="tab-profile" class="screen" style="padding: 20px;">
            <div style="background: white; border-radius: 24px; padding: 25px; text-align: center; box-shadow: var(--card-shadow);">
                <div style="width: 80px; height: 80px; background: var(--primary-grad); border-radius: 25px; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;"><i class="fas fa-user"></i></div>
                <h2 id="prof-name">User Name</h2>
                <p id="prof-email" style="color:#aaa;">user@email.com</p>
                <button class="btn-outline" style="border-radius: 12px; padding: 8px 20px; margin-top: 15px; font-size: 0.85rem;" onclick="openEditProfile()">Edit Profile</button>
            </div>
            
            <h3 style="margin: 25px 0 15px;">My Learning</h3>
            <div id="my-list"></div>

            <div style="margin-top: 30px; margin-bottom: 50px;">
                <div class="card" style="margin-bottom: 10px;" onclick="openSupport()">
                    <div class="card-body" style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-weight:600;"><i class="fas fa-headset" style="margin-right:10px; color: var(--primary);"></i> Support</span> <i class="fas fa-chevron-right" style="color:#ddd"></i>
                    </div>
                </div>
                <div class="card" onclick="document.getElementById('modal-policy').style.display='flex'">
                    <div class="card-body" style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-weight:600;"><i class="fas fa-shield-alt" style="margin-right:10px; color: var(--primary);"></i> Privacy</span> <i class="fas fa-chevron-right" style="color:#ddd"></i>
                    </div>
                </div>
                <button class="btn" style="background:#FF6B6B; box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3); margin-top:20px;" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>

    <div class="nav-bar" id="bottom-nav">
        <div class="nav-icon active" onclick="nav('home')"><i class="fas fa-home"></i> <span class="nav-text">Home</span></div>
        <div class="nav-icon" onclick="nav('courses')"><i class="fas fa-compass"></i> <span class="nav-text">Explore</span></div>
        <div class="nav-icon" onclick="nav('live')"><i class="fas fa-play-circle"></i> <span class="nav-text">Live</span></div>
        <div class="nav-icon" onclick="nav('profile')"><i class="fas fa-user"></i> <span class="nav-text">Profile</span></div>
    </div>

    <div id="modal-course" class="modal">
        <div class="modal-sheet">
            <div style="text-align: center; margin-bottom: 20px;"><div style="width: 40px; height: 5px; background: #eee; border-radius: 10px; display: inline-block;"></div></div>
            <div id="c-det-cont"></div>
        </div>
    </div>

    <div id="modal-pay" class="modal" style="z-index: 3500;">
        <div class="modal-sheet" style="text-align: center;">
            <div style="text-align: center; margin-bottom: 20px;"><div style="width: 40px; height: 5px; background: #eee; border-radius: 10px; display: inline-block;"></div></div>
            <h2 style="color:#2D3436; margin-bottom: 5px;">Secure Payment</h2>
            <p style="color:#888; margin-bottom: 20px;">Scan the QR code to proceed</p>
            <div style="background: white; padding: 20px; border-radius: 20px; box-shadow: 0 5px 25px rgba(0,0,0,0.05); display: inline-block;">
                <img id="qr-img" style="width:180px; height: 180px; object-fit: contain;">
            </div>
            <p id="upi-txt" style="font-weight:700; color:var(--primary); margin: 20px 0; background: rgba(108,99,255,0.1); padding: 10px; border-radius: 10px;"></p>
            
            <div class="card" style="border: 2px dashed #ccc; background: #FAFAFA;" onclick="document.getElementById('file-in').click()">
                <div class="card-body">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 1.5rem; color: #888;"></i>
                    <p style="color:#888; margin-top: 5px; font-size: 0.9rem;">Tap to upload screenshot</p>
                </div>
            </div>
            <input type="file" id="file-in" hidden onchange="showPre()">
            <img id="prev-img" style="width:100%; border-radius:15px; margin-top:10px; display:none;">
            
            <button class="btn" style="margin-top: 15px;" onclick="sendPay()">Submit Verification</button>
            <button class="btn-outline" style="width: 100%; margin-top: 10px; padding: 12px; border-radius: 14px;" onclick="closeModal('modal-pay')">Cancel</button>
        </div>
    </div>

    <div id="modal-edit" class="modal">
        <div class="modal-sheet">
            <h3>Update Profile</h3><br>
            <input class="input-box" id="ed-name" placeholder="Enter full name">
            <button class="btn" onclick="saveProfile()">Update</button>
            <button class="btn-outline" style="width: 100%; margin-top: 10px; padding: 12px; border-radius: 14px;" onclick="closeModal('modal-edit')">Cancel</button>
        </div>
    </div>

    <div id="modal-policy" class="modal">
        <div class="modal-sheet">
            <h3>Privacy Policy</h3>
            <p id="policy-content" style="color:#636E72; line-height:1.6; margin-top:15px; white-space: pre-wrap;">Loading...</p>
            <button class="btn" style="margin-top: 20px;" onclick="closeModal('modal-policy')">Close</button>
        </div>
    </div>

    <div id="toast-box">Action Successful</div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDlYp0e3EiP5k-XTyuZ_aYWfOHhdFlSdgk",
          authDomain: "course-making.firebaseapp.com",
          databaseURL: "https://course-making-default-rtdb.firebaseio.com",
          projectId: "course-making",
          storageBucket: "course-making.firebasestorage.app",
          messagingSenderId: "412011728854",
          appId: "1:412011728854:web:6d7502a659af6e2f519e77"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(), db = firebase.database(), storage = firebase.storage();

        let userData = null, branding = {}, allC = [], categories = [];
        let authMode = 'LOGIN';

        auth.onAuthStateChanged(user => {
            if(user) {
                db.ref('users/'+user.uid).on('value', s => {
                    userData = s.val();
                    if(userData){
                        document.getElementById('auth-screen').style.display='none';
                        document.getElementById('main-app').style.display='block';
                        document.getElementById('bottom-nav').style.display='flex';
                        document.getElementById('u-name').innerText = userData.name;
                        document.getElementById('prof-name').innerText = userData.name;
                        document.getElementById('prof-email').innerText = userData.email;
                        renderMy();
                    }
                });
            } else {
                document.getElementById('auth-screen').style.display='flex';
                document.getElementById('main-app').style.display='none';
                document.getElementById('bottom-nav').style.display='none';
            }
        });

        db.ref('branding').on('value', s => {
            branding = s.val() || {};
            if(branding.logo){
                document.getElementById('auth-logo').src = branding.logo;
                document.getElementById('auth-logo').style.display = 'block';
                document.getElementById('header-logo').src = branding.logo;
                document.getElementById('header-logo').style.display = 'block';
                document.getElementById('header-logo').style.width = '40px';
                document.getElementById('header-logo').style.height = '40px';
                document.getElementById('header-logo').style.borderRadius = '10px';
                document.getElementById('header-logo').style.marginRight = '12px';
            }
            if(branding.name) {
                document.getElementById('auth-title').innerText = branding.name;
                document.getElementById('app-title-head').innerText = branding.name;
                document.title = branding.name;
            }
            document.getElementById('policy-content').innerText = branding.policyText || 'No policy added yet.';
        });

        db.ref('promo').on('value', s => {
            let h = '';
            s.forEach(p => { h += `<div class="promo-card" style="background-image:linear-gradient(rgba(0,0,0,0.1),rgba(0,0,0,0.4)), url('${p.val().img}')"></div>`; });
            document.getElementById('home-promo').innerHTML = h || '<p style="color:#ccc; padding:20px;">No banners</p>';
        });

        db.ref('courses').on('value', s => {
            allC = []; categories = ['All'];
            s.forEach(c => {
                let d = c.val(); d.id = c.key; allC.push(d);
                if(d.category && !categories.includes(d.category)) categories.push(d.category);
            });
            renderChips(); renderC();
        });

        db.ref('liveSession').on('value', s => {
            const v = s.val();
            if(!v) return;
            document.getElementById('live-con').innerHTML = `
                <div class="card">
                    <div style="height:200px; background:#000; display:flex; align-items:center; justify-content:center; color:white; font-size:3rem;">
                        <i class="fas fa-broadcast-tower"></i>
                    </div>
                    <div class="card-body">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span class="chip active" style="margin:0; background:#FF6B6B;">${v.status}</span>
                            <h3 style="color:var(--primary); font-size:1.4rem;">₹${v.price}</h3>
                        </div>
                        <h2 style="margin:10px 0 5px;">Live Workshop</h2>
                        <p style="color:#777; font-size:0.9rem; line-height:1.5;">${v.description}</p>
                        <button class="btn" style="margin-top:15px;" onclick="window.open('${v.link}')">Join Session</button>
                    </div>
                </div>
            `;
        });

        function renderChips(){
            let h = '';
            categories.forEach(c => { h += `<div class="chip ${c==='All'?'active':''}" onclick="filterCat(this, '${c}')">${c}</div>`; });
            document.getElementById('cat-chips').innerHTML = h;
        }

        let currentCat = 'All';
        function filterCat(el, c){
            document.querySelectorAll('.chip').forEach(x => x.classList.remove('active'));
            el.classList.add('active'); currentCat = c; renderC();
        }

        function renderC(){
            const q = document.getElementById('search').value.toLowerCase();
            const f = allC.filter(c => (currentCat==='All' || c.category===currentCat) && (c.title.toLowerCase().includes(q)));
            let h = '', h2 = '';
            f.forEach(c => {
                const card = `
                    <div class="card" onclick="openCourse('${c.id}')">
                        <img src="${c.thumbnail}" class="course-img">
                        <div class="card-body">
                            <small style="color:var(--primary); font-weight:700; text-transform:uppercase; letter-spacing:1px;">${c.category}</small>
                            <h3 style="margin:5px 0;">${c.title}</h3>
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                                <span style="font-weight:700; font-size:1.1rem; color:#2D3436;">₹${c.price}</span>
                                <span style="color:#aaa; font-size:0.8rem;"><i class="fas fa-star" style="color:#FFD700;"></i> 4.8</span>
                            </div>
                        </div>
                    </div>
                `;
                h += card; if(f.indexOf(c) < 3) h2 += card;
            });
            document.getElementById('all-courses').innerHTML = h || '<p>No courses found</p>';
            document.getElementById('home-courses').innerHTML = h2 || '<p>No courses found</p>';
        }

        function openCourse(id){
            const c = allC.find(x => x.id === id);
            const has = userData.courses && userData.courses[id];
            let listH = '';
            if(c.content){
                Object.values(c.content).forEach(v => {
                    listH += `
                        <div class="card" style="margin-bottom:10px; border-radius:15px; background:#F8F9FE;" onclick="${has?`playVid('${v.link}')`:`showToast('Buy course to watch')`}">
                            <div class="card-body" style="display:flex; align-items:center; gap:15px; padding: 12px 15px;">
                                <div style="width:40px; height:40px; border-radius:10px; background:white; display:flex; align-items:center; justify-content:center; color:var(--primary); box-shadow:0 2px 5px rgba(0,0,0,0.05);"><i class="fas fa-play" style="font-size:0.8rem;"></i></div>
                                <div style="flex:1;">
                                    <h4 style="font-size:0.9rem;">${v.title}</h4>
                                    <small style="color:#aaa;">Video Lesson</small>
                                </div>
                                ${!has ? '<i class="fas fa-lock" style="color:#ddd; font-size:0.8rem;"></i>' : ''}
                            </div>
                        </div>
                    `;
                });
            }

            document.getElementById('c-det-cont').innerHTML = `
                <img src="${c.thumbnail}" style="width:100%; height:200px; object-fit:cover; border-radius:20px; margin-bottom:20px;">
                <h2 style="margin-bottom:5px;">${c.title}</h2>
                <p style="color:#777; line-height:1.6; font-size:0.95rem;">${c.description}</p>
                <h3 style="margin:25px 0 15px;">Course Content</h3>
                ${listH || '<p style="color:#ccc;">No lessons added yet.</p>'}
                <div style="margin-top:30px;">
                    ${has ? `<button class="btn" style="background:#00B894; box-shadow:0 10px 20px rgba(0,184,148,0.2);">Owned</button>` : `<button class="btn" onclick="openPay('${c.id}', ${c.price})">Enroll Now - ₹${c.price}</button>`}
                </div>
            `;
            document.getElementById('modal-course').style.display = 'flex';
        }

        function playVid(url){ window.open(url); }

        function openPay(cid, price){
            db.ref('adminSettings').once('value', s => {
                const v = s.val();
                if(v){
                    document.getElementById('qr-img').src = v.qr;
                    document.getElementById('upi-txt').innerText = v.upi;
                    window.currentPay = { cid, price };
                    document.getElementById('modal-pay').style.display = 'flex';
                }
            });
        }

        function showPre(){
            const f = document.getElementById('file-in').files[0];
            if(f){
                const r = new FileReader();
                r.onload = e => { 
                    document.getElementById('prev-img').src = e.target.result;
                    document.getElementById('prev-img').style.display = 'block';
                };
                r.readAsDataURL(f);
            }
        }

        async function sendPay(){
            const f = document.getElementById('file-in').files[0];
            if(!f) return alert('Upload screenshot');
            showToast('Uploading...');
            const ref = storage.ref('payments/'+Date.now());
            await ref.put(f);
            const url = await ref.getDownloadURL();
            db.ref('payments').push({
                uid: auth.currentUser.uid,
                email: userData.email,
                cid: window.currentPay.cid,
                price: window.currentPay.price,
                proof: url,
                status: 'PENDING',
                timestamp: Date.now()
            }).then(() => {
                closeModal('modal-pay');
                showToast('Sent for verification!');
            });
        }

        function renderMy(){
            if(!userData.courses) return document.getElementById('my-list').innerHTML = '<p style="color:#ccc; text-align:center; padding:20px;">No courses purchased yet.</p>';
            let h = '';
            Object.keys(userData.courses).forEach(id => {
                const c = allC.find(x => x.id === id);
                if(c) h += `
                    <div class="card" style="margin-bottom:12px;" onclick="openCourse('${c.id}')">
                        <div class="card-body" style="display:flex; align-items:center; gap:15px; padding:12px;">
                            <img src="${c.thumbnail}" style="width:60px; height:60px; border-radius:12px; object-fit:cover;">
                            <div style="flex:1;">
                                <h4 style="font-size:0.95rem; margin-bottom:2px;">${c.title}</h4>
                                <div style="width:100%; height:6px; background:#f0f0f0; border-radius:10px; margin-top:8px;"><div style="width:40%; height:100%; background:var(--primary); border-radius:10px;"></div></div>
                            </div>
                            <i class="fas fa-chevron-right" style="color:#eee;"></i>
                        </div>
                    </div>
                `;
            });
            document.getElementById('my-list').innerHTML = h;
        }

        function openEditProfile(){
            document.getElementById('ed-name').value = userData.name;
            document.getElementById('modal-edit').style.display='flex';
        }
        function saveProfile(){
            db.ref('users/'+auth.currentUser.uid).update({ name: document.getElementById('ed-name').value })
            .then(() => { closeModal('modal-edit'); showToast('Profile Updated'); });
        }

        function openNotif(){
            nav('notif');
            db.ref('notifications').on('value', s => {
                let h = '';
                const arr = [];
                s.forEach(n => arr.unshift(n.val()));
                arr.forEach(n => {
                    if(n.targetType==='ALL' || (n.targetType==='SINGLE' && n.targetEmail===userData.email)){
                        h += `
                            <div class="notif-item" onclick="${n.link?`window.open('${n.link}')`:''}">
                                <div class="notif-icon"><i class="fas fa-bell"></i></div>
                                <div>
                                    <p style="font-size:0.95rem; font-weight:500; color:#2D3436;">${n.message}</p>
                                    <small style="color:#aaa;">${new Date(n.timestamp).toLocaleDateString()}</small>
                                </div>
                            </div>
                        `;
                    }
                });
                document.getElementById('list-notif').innerHTML = h || '<p style="text-align:center; padding:40px; color:#ccc;">No notifications</p>';
            });
        }

        function toggleMode(){
            authMode = authMode === 'LOGIN' ? 'SIGNUP' : 'LOGIN';
            document.getElementById('btn-auth').innerText = authMode === 'LOGIN' ? 'Sign In' : 'Create Account';
            document.getElementById('txt-mode').innerText = authMode === 'LOGIN' ? 'Create new account' : 'Already have an account? Login';
            document.getElementById('a-name').style.display = authMode === 'LOGIN' ? 'none' : 'block';
        }

        function submitAuth(){
            const e = document.getElementById('a-email').value, p = document.getElementById('a-pass').value, n = document.getElementById('a-name').value;
            if(authMode==='SIGNUP'){
                auth.createUserWithEmailAndPassword(e, p).then(res => {
                    db.ref('users/'+res.user.uid).set({ name:n, email:e, uid:res.user.uid });
                }).catch(err => alert(err.message));
            } else {
                auth.signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
            }
        }

        function logout(){ auth.signOut(); }
        function openSupport(){ if(branding.supportLink) window.open(branding.supportLink); }
        function nav(id){
            document.querySelectorAll('.screen').forEach(s => s.style.display='none');
            document.getElementById('tab-'+id).style.display='block';
            document.querySelectorAll('.nav-icon').forEach(i => i.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }
        function closeModal(id){ document.getElementById(id).style.display = 'none'; }
        function showToast(m){
            const t = document.getElementById('toast-box'); t.innerText = m; t.style.opacity = '1';
            setTimeout(() => t.style.opacity = '0', 3000);
        }

        window.onclick = e => { if(e.target.classList.contains('modal')) e.target.style.display='none'; }
    </script>
</body>
</html>
